import {CONTENT} from '../constants';

const mediaSharesUtils = {};

/**
 * parses the relevant values for mediaShares: contentId, disposition
 * @param {Object} mediaShares
 * @returns {undefined}
 */
mediaSharesUtils.parse = (mediaShares) => {
  if (mediaShares) {
    return {
      contentId: mediaSharesUtils.getContentId(mediaShares),
      disposition: mediaSharesUtils.getDisposition(mediaShares)
    };
  }

  return null;
};

/**
 * get the previous and current mediaShares values parsed, as well as the boolean updates
 * @param {Object} oldShare
 * @param {Object} newShare
 * @returns {Object}
 * previous: {Object} old share, current: {Object} new share,
 */
mediaSharesUtils.getMediaShares = (oldShare, newShare) => {
  const previous = oldShare && mediaSharesUtils.parse(oldShare);
  const current = newShare && mediaSharesUtils.parse(newShare);

  return {
    previous,
    current
  };
};

/**
 * get the floor disposition (released, granted)
 * @param {Object} mediaShares
 * @returns {Boolean} disposition
 */
mediaSharesUtils.getDisposition = (mediaShares) => {
  const contentFloor = mediaSharesUtils.extractContentFloor(mediaShares);

  return contentFloor ? contentFloor.disposition : null;
};

/**
 * extract the content property from media shares
 * @param {Object} mediaShares
 * @returns {Object}
 */
mediaSharesUtils.extractContent = (mediaShares) => {
  if (!mediaShares || !mediaShares.length) {
    return null;
  }

  return mediaShares.find((share) => share.name === CONTENT) || null;
};

/**
 * extract the floor property from content object
 * @param {Object} content
 * @returns {Object}
 */
mediaSharesUtils.extractFloor = (content) => {
  if (!content) {
    return null;
  }

  return content.floor;
};

/**
 * extract the content's floor from media shares
 * @param {Object} mediaShares
 * @returns {Object}
 */
mediaSharesUtils.extractContentFloor = (mediaShares) => {
  const content = mediaSharesUtils.extractContent(mediaShares);

  return mediaSharesUtils.extractFloor(content);
};

/**
 * get who is sharing from media shares
 * @param {Object} mediaShares
 * @returns {Object}
 */
mediaSharesUtils.getContentId = (mediaShares) => {
  const contentFloor = mediaSharesUtils.extractContentFloor(mediaShares);

  if (!contentFloor || !contentFloor.beneficiary) {
    return null;
  }

  return contentFloor.beneficiary.id;
};

export default mediaSharesUtils;
