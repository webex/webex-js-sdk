/* eslint-env browser */

/*!
 * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.
 */
import {MemoryStoreAdapter} from '@ciscospark/spark-core';

require('@ciscospark/plugin-authorization');
require('@ciscospark/internal-plugin-wdm');
require('@ciscospark/internal-plugin-calendar');
require('@ciscospark/plugin-logger');
require('@webex/plugin-meetings');
require('@webex/plugin-device-manager');

const merge = require('lodash/merge');
const SparkCore = require('@ciscospark/spark-core').default;

const config = {
  hydraServiceUrl: process.env.HYDRA_SERVICE_URL || 'https://api.ciscospark.com/v1',
  credentials: {
    clientType: 'confidential'
  },
  device: {
    ephemeral: true
  },
  storage: {
    boundedAdapter: MemoryStoreAdapter,
    unboundedAdapter: MemoryStoreAdapter
  }
};

const CiscoSpark = SparkCore.extend({
  ciscospark: true,
  version: PACKAGE_VERSION
});

CiscoSpark.init = function init(attrs = {}) {
  attrs.config = merge({}, config, attrs.config); // eslint-disable-line no-param-reassign

  return new CiscoSpark(attrs);
};

window.ciscospark = CiscoSpark;
