import {assert} from '@webex/test-helper-chai';

import EmbeddedAppUtils from '@webex/plugin-meetings/src/locus-info/embeddedAppsUtils';

describe('plugin-meetings', () => {
  describe('embeddedAppsUtils', () => {
    const slidoApp = {
      url: 'https://hecate-b.wbx2.com/apps/api/v1/locus/7a4994a7',
      sequence: 138849877016800000,
      appId: 'Y2lzY29zcGFyazovL3VzL0FQUExJQ0FUSU9OLzQxODc1MGQ0LTM3ZDctNGY2MC1hOWE3LWEwZTE1NDFhNjRkNg',
      instanceInfo: {
        appInstanceUrl: 'https://webex.sli.do/participant/event/mFKKjcYxzx9h31eyWgngFS?clusterId=eu1',
        externalAppInstanceUrl: '',
        title: 'Active session'
      },
      state: 'STARTED',
      lastModified: '2022-10-13T21:01:41.680Z'
    };
    const otherApp = {
      url: 'https://hecate-b.wbx2.com/apps/api/v1/locus/7a4994a7',
      sequence: 138849877016800000,
      appId: 'some-other-app-id',
      instanceInfo: {
        appInstanceUrl: 'https://webex.someotherapp.com/mFKKjcYxzx9h31eyWgngFS?clusterId=eu1',
        externalAppInstanceUrl: '',
        title: 'Active session'
      },
      state: 'STARTED',
      lastModified: '2022-10-13T21:01:31.680Z'
    };

    describe('parseApp', () => {
      it('returns a parsed embedded app with type of SLIDO', () => {
        const parsedApp = EmbeddedAppUtils.parseApp(slidoApp);
        const expectedApp = {...slidoApp, ...{type: 'SLIDO'}};

        assert.deepEqual(parsedApp, expectedApp);
      });

      it('returns a parsed embedded app with type of OTHER', () => {
        const parsedApp = EmbeddedAppUtils.parseApp(otherApp);
        const expectedApp = {...otherApp, ...{type: 'OTHER'}};

        assert.deepEqual(parsedApp, expectedApp);
      });
    });

    describe('parse', () => {
      it('returns a copy of embeddedApps', () => {
        const embeddedApps = [slidoApp];
        const parsedApps = EmbeddedAppUtils.parse(embeddedApps);

        assert.notStrictEqual(parsedApps, embeddedApps);
        assert.equal(parsedApps.length, embeddedApps.length);
      });
    });
  });
});
