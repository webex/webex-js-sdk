# Web Meetings SDK Definitions & Eventing

## Objects
- [meetings](#meetings)
- [meeting](#meeting)
- [members](#members)
- [member](#member)
- [devices](#devices)
- [device](#device)
- [share](#share)
- [whiteboards](#whiteboards)
- [whiteboard](#whiteboard)
- [webrtc](#webrtc)
- [media](#media)
- [media-checker](#media-checker)
- [roap](#roap)

---
## meetings

> Note: Internally we will maintain a cache of meetings and sync remotely.

### _initialize()_ - function 
> For now, spark will be passed. If following the current plugin architecture,
> this will be `spark.meetings.initialize`.

- Ensure spark object is ready and valid.
If one is not passed, do the initialization.  
If web socket is not connected, connect.
Hook up listeners.
Get the PMR and add it as a property on this object.

### _create(destination)_ - function  
> Internally creates a "call" (per current SDK syntax). TODO: Should this still create a call to conform to API?
>
> - TODO: Can all scenarios get a meetingID?
> - TODO: Can `spaceID` be a public destination?
- public destinations: sipURL
- internal destinations: locusID, meetingURL, globalMeetingID, e.g, *00*meetingID, meetingID, meetingURL, PSTN, phone number
- return meeting object

### _get(meetingID)_ - function
- return a meeting object  

### _getAll()_ - function
- options will include limits of dates, etc. (get all meetings between these dates)
- return collection of all active and scheduled meetings

### _getActiveMeetings_ - function
- return collection of all active meetings

### _getScheduledMeetings_ - function
> TODO: See what the shape of the objects are returned from calendar service.
- return collection of all scheduled meetings

### _isConnected_ - bool 

### _pmr_ - object
 - return cached PMR object or goes to get it if needed

#### events

### create
- meeting
### connectionChange OR statusChange
> Developers not familiar with the Cisco ecosystem may not recognize it easily.
> `statusChange` may be more universal and is consistent with other events.
- connection string: connecting, connected, disconnecting, disconnected
> /calls API had: initializing, lobby, connected, terminating, disconnected

### ready

---
## meeting
> TODO: Clarify `updateAudio`, `Video`, `Share` methods. Are they solely for Webex meeting?

### _join()_ - function   
- options: paired device (e.g., tp unit), password (if meeting requires host PIN or password)
- specify joining via audio (option: pstn), video, screenshare
- return Promise
    - resolve
    - reject: "hostPinOrPasswordRequired/actionRequired"

#### events
> TODO: Standardize with calling API events.
### statusChange
- status: joining, pre_lobby, in_lobby, "pstn_dialing_in", "pstn_dialing_out", joined
### actionRequired
> e.g., hostPinOrPasswordRequired

### _moveToDevice(deviceID)_ - function
- move this meeting to given device
- only possible if you are paired with the given device
- return Promise

### _moveToClient()_ - function
- move this meeting back to "my laptop"
- return Promise

### _updateAudio()_ - function
- options: pstn, computer, resource (e.g., tp unit)
- "add" or "remove" an audio source
- return Promise
    - resolve
    - reject: if mercury negotiation fails outright, or timeout occurs, or locus is rejection

### _updateVideo()_ - function
- "add" or "remove" a video source
- return Promise
    - resolve
    - reject: if mercury negotiation fails outright, or timeout occurs, or locus is rejection

### _updateShare()_ - function
- `ShareType`: screenshare, application share, or any media stream
- return Promise
  - resolve
  - reject: if mercury negotiation fails outright, or timeout occurs, or locus is rejection

### _share_ - function
- aliases _updateShare_

### _leave()_ - function 
- options: device ID (server-side: resource ID) for paired device? 
- if 1:1, meeting ends
- else if host, meeting ends
- else, meeting continues
- return Promise

### _decline()_ - function  
- return Promise

### _sendDtmf()_ - function 
- options: key (string)
- return Promise

### _getStats()_ - function
> TODO: This may need a more explicit name, e.g., `getWebRTCStats`
- return Promise of standardized `getStats`

### _lock_ - function
> TODO: Define

### _unlock_ - function
> TODO: Define

### _startRecording_ - function
> TODO: Define

### _stopRecording_ - function
> TODO: Define

### _id_ - string

### _spaceID_ - string
> Note: Follows the Hydra convention of `spaceID`.

### _members_ - collection of members

### _peerConnections_ - object
- right now, there are 2: main, screen

### _health_ - object
> TODO: Define
- from webrtc internal

### _type_ - string 
- 1:1, claimedPMR, spaceMeeting, unclaimedPMR, webexScheduledMeeting

### _direction_ - string  
> Webex meetings have no concept of direction and will be `undefined`.
- incoming, outgoing

### _pairedDevice_ - device object

### _startTime_ - ISOString  
### _endTime_ - ISOString 

#### events
### _statusChange_  
- status, e.g., leaving, left
- reason  

### _typeChange_  
- type  
- reason  

### _leave_
- leaving, left 

### _join_
- joining, joined

### _end_
- ending, ended

#### meeting.metrics

- media (webrtc specific stuff)
- MQE (this may cover "media" above) (Media Quality Events)
- callAnalyzer (event sequencing)
- meetingEndMetrics?

---
## members
> Note: The terms "memberships", "members" has helped to clarify relationships between *participants*, *people*, and *rooms* in the API.

### _get()_ - function 
- return Promise
    - collection of members (most likely members are there; if a large meeting, members will have to be retrieved). SDK will have a cache of members (amongst other things) that will be updated/synced.

### _getSelf()_ - function  
- return member self

### _getHosts()_ - function
> Only for Webex meetings.
>
> Webex Teams Moderators are not equivalent to Webex Hosts.
> In Teams, anyone can act as a host.
- return collection of members

### _add(member)_ - function  
> TODO: For scheduled meetings, the equivalent is to add invitees.
> However, the people who attend the instance of the meeting are
> different than those who are invited to the scheduled/recurring meeting.
- params: member
- return Promise
    - resolve: member
    - reject

#### events
> These "bubble up" from member. See [member.changed](#member.changed).

---
## member

### _muteAudio()_ - function
- return Promise

### _unmuteAudio()_ - function
- return Promise
  
### _muteVideo()_ - function  
- return Promise

### _unmuteVideo()_ - function
- return Promise

### _remove()_ - function  
> For Webex, only Webex Hosts can remove. For Teams, anyone can remove.
- return Promise
    - resolve
    - reject
        - if something on server fails
        - if, on Webex, they are not the host

### _admit()_ - function  
> Admit a member in the *Lobby*.
- return Promise

### _makeHost()_ - function
> For Webex, only Hosts can make another person a Host. For Teams,
> everyone has "host" capabilities.
- return Promise
    - resolve
    - reject
        - if something on server fails
        - if, on Webex, they are not the host

### _id_ - string  
### _isGuest_ - boolean
### _isHost_ - boolean
### _devices_ - collection
### _mutedAudio_ - boolean  
### _mutedVideo_ - boolean  

#### events 

### member.changed
- member
- change: audioMuted, videoMuted, left, joined, madeHost, shared
> /calls API had: waiting, lobby, notified, declined, joined, left

---
## devices
This describes devices that are manually or automatically paired with member.

### _getAll()_ - function
Talks with lyra service and gets devices both inside and outside of the org.
- return Promise
    - resolve: collection of all devices
    - TODO: Some devices may have members paired to them; do we want to distinguish this with a function like `getUnpaired()`?)

### _get(deviceID)_ - function
- return the device object

---
## device  

### _requestPairingCode()_ - function
Request pairing of a device, AKA resource.
- return Promise
    - resolve: challenge is returned

### _pair()_ - function
> TODO: Can a member pair with a single device or multiple devices? 
- params: PIN/challenge (challenge string)
- return Promise
    resolve: token that is used to control the device; this will be saved to the device object
reject

### _join()_ - function
> Requires someone to be paired.
>
> TODO: What are the possible responses from the cloud service? 
- return Promise
    - resolve
    - reject
        - if not paired

### _muteVideo()_ - function  
> TODO: is this possible? 
- return Promise

### _unmuteVideo()_ - function 
> TODO: is this possible? 
- return Promise
 
### _muteAudio()_ - function
This may not be automatically returned from all services depending on the scenario. We may need to query lyra to get the status of the device, for example. 
- return Promise

### _unmuteAudio()_ - function  
This may not be automatically returned from all services depending on the scenario. We may need to query lyra to get the status of the device, for example. 
- return Promise

> We should add `startShare` and `stopShare` here to be consistent with the *grouping* of **audio, video,
> share**. Alternately, remove muting audio and video from `device` to be consistent.

### _unpair()_ - function
- return Promise

### _leave()_ - function
> Requires someone to be paired.
- return Promise

### _id_ - string  
### _status_ - string
- sleep, awake
### _isPaired_ - bool
### _pairedToken_ - string
### _type_ - string

---
## share  

### _start(MediaStream)_ - function 
MediaStreams can be constructed or retrieved with getUserMedia
https://developer.mozilla.org/en-US/docs/Web/API/MediaStream/MediaStream
Whole tabs, whole screens can be converted to streams, for example. 

- internal: API calls, connect to locus and calliope (locus -> calliope -> mercury)
- return Promise
    - resolve: challenge to correlate ROAP; must depend on locus events
    - reject

### _startScreenShare(resolution, framerate)_ - function
Generate a MediaStream, then pass it to `start()`.
- return _start_(mediaStream)

_startApplicationShare(resolution, framerate)_ - function  
Generate a MediaStream, then pass it to `start()`.
- return _start_(mediaStream)

_startWhiteboardShare()_ - function 
> Restricted to space meetings. TODO: Will all meetings created through the SDK have a space?
>
> TODO: Define parameters with Saurabh.
- params: ? 
Generate a MediaStream, then pass it to `start()`.
- return _start_(mediaStream)
 
### _stop()_ - function  
Stops the active share.
- return Promise

### _status_ - string
- idle, ongoing, terminating, share_failed, stop_share_failed, starting

### _type_ - string
- screen, application, whiteboard, stream

#### events

### statusChange
    - status
    - reason

---
## whiteboards  
> TODO: Define with Saurabh.

---
## whiteboard  
> TODO: Define with Saurabh.

---
## media (mimic browser APIs)

Mimic browser APIs as "the ultimate browser". Handles the quirks of each browser. Extends and enhances adapter.js, i.e., the "media" file from the web client.

### _getUserMedia_ - function
### _getSupportedDevice_ - function
### _getScreenshare()_ - function
> For Chrome, must do plugin-less share.

### _toggleStream()_ - function
### _stopStream()_ (or stopMedia)- function

### _devices_
### _streams_

---
## media-checker
> +1 Amwell wants this.

### _getAnalysis_ - function
> Cisco-specific stuff
Get raw info and perform analysis with stats.

### _isVideoRendered_
### _isMediaSending_
### _isMediaQuality"Good"_
> - TODO: Needs a formal name.
> - TODO: How is "good quality" defined?

### _isAudioSent_

## webrtc 

APIs to talk with the browser.
This package could theoretically be used by any third-party project.

### ice

### stats.js (or statsInterface.js)

### _printStatsToConsole_ - function
### _getHistory_ - function
### _getRawInfo_ - function
> Before analysis

### _setPeerConnectionAndVideo_ - function
> TODO: Should these be split up into explicit call?

### Other submodules

- history
- constants
- generator - generates objects to be filled
- parser
- transformer
- extractor
- analyzer 
- validator 
- logger

## roap

ROAP will be implemented similarly to the web client, but without the obvious flux patterns.

These are the current web client files: 
- roapInterface - Accepts parameters whose values come from the meeting object (what has to be sent); return Promise with request body
- roapAdapter - Sends requests to server, i.e., makes API calls.
- roapHandler - A state manager; "This meeting is in this particular state."
