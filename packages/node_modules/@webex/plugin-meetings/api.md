# Web Meetings SDK Definitions & Eventing

## Objects
- [meetings](#meetings)
- [meeting](#meeting)
- [participants](#participants)
- [participant](#participant)
- [devices](#devices)
- [device](#device)
- [share](#share)
- [webrtc](#webrtc)
- [media](#media)
- [media-checker](#media-checker)
- [whiteboards](#whiteboards)
- [whiteboard](#whiteboard)

---
## meetings

> Note: Internally we will maintain a cache of meetings and sync remotely.

### _initialize()_ - function 
> For now, spark will be passed. If following the current plugin architecture,
> this will be `spark.meetings.initialize`.

- Ensure spark object is ready and valid.
If one is not passed, do the initialization.  
If web socket is not connected, connect.
Hook up listeners.
Get the PMR and add it as a property on this object.

### _create(destination)_ - function  
> Internally creates a "call" (per current SDK syntax). TODO: Should this still create a call to conform to API?
>
> - TODO: Can all scenarios get a meetingID?
> - TODO: Can `spaceID` be a public destination?
- public destinations: sipURL
- internal destinations: locusID, meetingURL, globalMeetingID, e.g, *00*meetingID, meetingID, meetingURL, PSTN, phone number
- return meeting object

### _get(meetingID)_ - function
- return a meeting object  

### _getAll()_ - function
- options will include limits of dates, etc. (get all meetings between these dates)
- return collection of all active and scheduled meetings

### _getActiveMeetings_ - function
- return collection of all active meetings

### _getScheduledMeetings_ - function
> TODO: See what the shape of the objects are returned from calendar service.
- return collection of all scheduled meetings

### _isConnected_ - bool 

### _pmr_ - object
 - return cached PMR object or goes to get it if needed

---
## meeting
> TODO: Clarify `updateAudio`, `Video`, `Share` methods. Are they solely for Webex meeting?

### _join()_ - function   
- options: paired device (e.g., tp unit), password (if meeting requires host PIN or password)
- specify joining via audio (option: pstn), video, screenshare
- return Promise
    - resolve
    - reject: "hostPinOrPasswordRequired/actionRequired"

#### events: 
> TODO: Standardize with calling API events.
- statusChange event: joining, pre_lobby, in_lobby, "pstn_dialing_in", "pstn_dialing_out", joined
- actionRequired event: e.g., hostPinOrPasswordRequired

### _moveToDevice(deviceID)_ - function
- move this meeting to given device
- only possible if you are paired with the given device
- return Promise

### _moveToClient()_ - function
- move this meeting back to "my laptop"
- return Promise

### _updateAudio()_ - function
- options: pstn, computer, resource (e.g., tp unit)
- "add" or "remove" an audio source
- return Promise
    - resolve
    - reject: if mercury negotiation fails outright, or timeout occurs, or locus is rejection

### _updateVideo()_ - function
- "add" or "remove" a video source
- return Promise
    - resolve
    - reject: if mercury negotiation fails outright, or timeout occurs, or locus is rejection

### _updateShare()_ - function
- `ShareType`: screenshare, application share, or any media stream
- return Promise
  - resolve
  - reject: if mercury negotiation fails outright, or timeout occurs, or locus is rejection

### _share_ - function
- aliases _updateShare_

### _leave()_ - function 
- options: device ID (server-side: resource ID) for paired device? 
- if 1:1, meeting ends
- else if host, meeting ends
- else, meeting continues
- return Promise

### _decline()_ - function  
- return Promise

### _sendDtmf()_ - function 
- options: key (string)
- return Promise

### _getStats()_ - function
> TODO: This may need a more explicit name, e.g., `getWebRTCStats`
- return Promise of standardized `getStats`

### _lock_ - function
> TODO: Define

### _unlock_ - function
> TODO: Define

### _startRecording_ - function
> TODO: Define

### _stopRecording_ - function
> TODO: Define

### _id_ - string

### _spaceID_ - string
> Note: Follows the Hydra convention of `spaceID`.

### _participants_ - ParticipantCollection  

### _peerConnections_ - object
- right now, there are 2: main, screen

### _health_ - object
> TODO: Define
- from webrtc internal

### _type_ - string 
- 1:1, claimedPMR, spaceMeeting, unclaimedPMR, webexScheduledMeeting

### _direction_ - string  
> Webex meetings have no concept of direction and will be `undefined`.
- incoming, outgoing

### _pairedDevice_ - device object

### _startTime_ - ISOString  
### _endTime_ - ISOString 

#### events
### _statusChange_  
- status, e.g., leaving, left
- reason  

### _typeChange_  
- type  
- reason  

### _leave_
- leaving, left 

### _join_
- joining, joined

### _end_
- ending, ended

#### meeting.metrics

- media (webrtc specific stuff)
- MQE (this may cover "media" above) (Media Quality Events)
- callAnalyzer (event sequencing)
- meetingEndMetrics?

---
## participants (or memberships)
> Note: The term "memberships, members" has helped to clarify relationships in the API.

### _get()_ - function 
- return Promise
    - collection of participants (most likely participants are there; if a large meeting, participants will have to be retrieved). SDK will have a cache of participants (amongst other things) that will be updated/synced.

### _getSelf()_ - function  
- return participant self

### _getHosts()_ - function
> Only for Webex meetings.
>
> Webex Teams Moderators are not equivalent to Webex Hosts.
> In Teams, anyone can act as a host.
- return collection of participants

### _add(participant)_ - function  
> TODO: For scheduled meetings, the equivalent is to add invitees.
> However, the people who attend the instance of the meeting are
> different than those who are invited to the scheduled/recurring meeting.
- params: participant
- return Promise
    - resolve: participant
    - reject

#### events
> These "bubble up" from participant.

### participant.changed
- participant 
- change: audioMuted, videoMuted, left, joined, madeHost

---
## participant (or member)

### _muteAudio()_ - function
- return Promise

### _unmuteAudio()_ - function
- return Promise
  
### _muteVideo()_ - function  
- return Promise

### _unmuteVideo()_ - function
- return Promise

### _remove()_ - function  
> For Webex, only Webex Hosts can remove. For Teams, anyone can remove.
- return Promise
    - resolve
    - reject
        - if something on server fails
        - if, on Webex, they are not the host

### _admit()_ - function  
> Admit a participant in the *Lobby*.
- return Promise

### _makeHost()_ - function
> For Webex, only Hosts can make another person a Host. For Teams,
> everyone has "host" capabilities.
- return Promise
    - resolve
    - reject
        - if something on server fails
        - if, on Webex, they are not the host

### _id_ - string  
### _isGuest_ - boolean
### _isHost_ - boolean
### _devices_ - collection
### _mutedAudio_ - boolean  
### _mutedVideo_ - boolean  

#### events 

### participant.changed
- participant 
- change: audioMuted, videoMuted, left, joined, madeHost

---
## devices
This describes devices that are manually or automatically paired with participant.

### _getAll()_ - function
Talks with lyra service and gets devices both inside and outside of the org.
- return Promise
    - resolve: collection of all devices
    - TODO: Some devices may have participants paired to them; do we want to distinguish this with a function like `getUnpaired()`?)

### _get(deviceID) - function
- return the device object

---
## device  

_requestPair()_ - function
request pairing of a device (resource)
return Promise
challenge is returned

_pair()_ - function
params: PIN/challenge (challenge string)
TODO: Can a participant pair with a single device or multiple devices? 
return Promise
return token; this token is used to control the device; this will be saved to the device object
reject

_join()_ - function
requires someone to be paired
if not paired, return error "you need to be paired"
return Promise
TODO: What are the possible responses from the cloud service? 

_muteVideo()_ - function  
TODO: is this possible? 
return Promise

_unmuteVideo()_ - function 
TODO: is this possible? 
return Promise
 
_muteAudio()_ - function
this may not be automatically returned from all services depending on the scenario. We may need to query lyra to get the status of the device, for example. 
return Promise
success 
reject

_unmuteAudio()_ - function  
this may not be automatically returned from all services depending on the scenario. We may need to query lyra to get the status of the device, for example. 
return Promise
success 
reject

_unpair()_ - function
return Promise

_leave()_ - function
requires someone to be paired
return Promise

_id_ - string  
_status_ - string, "sleep, awake"  
_isPaired_ - bool
_pairedToken_ - string
_type_ - string

---
## share  

_start(<MediaStream>)_ - function 
MediaStreams can be constructed or retrieved with getUserMedia
https://developer.mozilla.org/en-US/docs/Web/API/MediaStream/MediaStream
Whole tabs, whole screens can be converted to streams, for example. 
internal: API calls, connect to locus and calliope (locus -> calliope -> mercury)
return Promise
resolve
Challenge to correlate ROAP; must depend on locus events
reject

_startScreenShare()_ - function  
params: resolution, framerate
return _start_()

_startApplicationShare()_ - function  
params: resolution, framerate
return _start_()

_startWhiteboardShare()_ - function 
params: ? 
restricted to space meetings
TODO: Saurabh has a better idea of whiteboards
return _start_()
 
_stop()_ - function  
stops the active share
return Promise

_status_ - string, "idle, ongoing, terminating, share_failed, stop_share_failed, starting" 
_type_ - string, "screen, application, whiteboard, stream"

---
## whiteboards  
> TODO: Define with Saurabh.

---
## whiteboard  
> TODO: Define with Saurabh.

---
## media (mimic browser APIs)

Mimic browser APIs as "the ultimate browser". Handles the quirks of each browser. Extends and enhances adapter.js, i.e., the "media" file from the web client.

_getUserMedia_
_getSupportedDevice_
_getScreenshare()_ - function
For Chrome, must do plugin-less share

toggleStream()
stopStream/Media()

_devices_
_streams_

---
## media-checker

*getAnalysis (Cisco specific stuff) - get raw info and perform analysis with stats
isVideoRendered
isMediaSending
isMediaQualityGood (how is good defined?)
isAudioSent

### webrtc 

APIs to talk with the browser

#### ice

#### stats.js (or statsInterface.js)

printStatsToConsole
getHistory
getRawInfo (before analysis)
setPeerConnectionAndVideo

##### "submodules"

history
constants
generator - generates objects to be filled
parser
transformer
extractor
analyzer 
validator 
logger

### roap

web client files: 
roapInterface - accepts parameters whose values come from the meeting object (what has to be sent); return Promise with request body
roapAdapter - requests to server (makes API calls)
roapHandler - state manager; "this meeting is in this state"


## Eventing

**meetings**  
**meeting**  
**share**  
**participants**
**participant**

### meetings  
_create_  
1. meeting  
_connectionChange_  
1. connection string, "connecting, connected, disconnecting, disconnected" . 
_ready_  

### meeting  
_statusChange_  
1. status  
2. reason  

_typeChange_  
1. type  
2. reason  

_leave_  
_join_  
_end_  

### share  
_statusChange_  
1. status  
2. reason

