/*!
 * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.
 */

import {assert} from '@ciscospark/test-helper-chai';
import MockSpark from '@ciscospark/test-helper-mock-spark';
import sinon from '@ciscospark/test-helper-sinon';
import Team from '@ciscospark/internal-plugin-team';
import User from '@ciscospark/internal-plugin-user';

describe('plugin-team', () => {
  describe('Team', () => {
    let spark;

    beforeEach(() => {
      spark = new MockSpark({
        children: {
          team: Team,
          user: User
        }
      });

      spark.internal.user.recordUUID = sinon.spy();
    });

    describe('#create()', () => {
      it('requires a displayName', () => assert.isRejected(spark.internal.team.create({}), /`params.displayName` is required/));

      it('requires a participants attribute', () => assert.isRejected(spark.internal.team.create({displayName: 'test'}), /`params.participants` is required/));

      it('requires a participants array', () => assert.isRejected(spark.internal.team.create({displayName: 'test', participants: []}), /`params.participants` is required/));
    });

    describe('#createConversation()', () => {
      it('requires a displayName', () => assert.isRejected(spark.internal.team.createConversation({}, {}), /`params.displayName` is required/));

      it('requires a team object with a general conversation', () => assert.isRejected(spark.internal.team.createConversation({}, {displayName: 'test'}), /`team.generalConversationUuid` must be present/));
    });

    describe('#prepareTeamConversation()', () => {
      it('requires a KRO', () => assert.isRejected(spark.internal.team._prepareTeamConversation({}), /Team general conversation must have a KRO/));
    });

    describe('#recordUUIDs', () => {
      it('resolves if there are no teamMembers', () => spark.internal.team._recordUUIDs({})
        .then(() => assert.equal(spark.internal.user.recordUUID.callCount, 0)));

      it('resolves if there isn\'t teamMembers.items', () => spark.internal.team._recordUUIDs({teamMembers: {}})
        .then(() => assert.equal(spark.internal.user.recordUUID.callCount, 0)));
    });
  });
});
