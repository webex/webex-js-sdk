/*!
 * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.
 */

import Support from '@ciscospark/internal-plugin-support';

import {assert} from '@ciscospark/test-helper-chai';
import MockSpark from '@ciscospark/test-helper-mock-spark';

describe(`plugin-support`, function() {
  this.timeout(20000);

  let spark;

  beforeEach(() => {
    spark = new MockSpark({
      children: {
        support: Support
      }
    });
  });

  describe(`#_constructFileMetadata()`, () => {
    it(`constructs a sample File Meta Data`, () => {
      const result = spark.internal.support._constructFileMetadata({});

      assert.equal(result.length, 1);
      assert.deepEqual(result, [{
        key: `trackingId`,
        value: `mock-spark_88888888-4444-4444-4444-aaaaaaaaaaaa`
      }]);
    });
  });

  describe(`#submitLogs()`, () => {
    it(`calls getUserToken`, () => {
      spark.internal.support.submitLogs({});
      assert.calledOnce(spark.credentials.getUserToken);
    });
  });

});
