# @ciscospark/sparkd

> HTTP Daemon for interacting with the Spark JavaScript SDK

## wat

Why would we put an http server in front of our SDK? Encryption is hard and this lets all of our client test suites (potentially written in languages for which we do not have sdks) do encrypted things without a major time expenditure

## how

1. Install via npm
  ```bash
  npm install -g @ciscospark/sparkd
  ```

2. Run
  ```bash
  sparkd
  ```

3. Create a session (make sure to copy your set cookie header)
  ```
  curl -X POST \
    -H "Content-Type: application/json" \
    -d '{"clientId":"<your client id>","clientSecret":"<your client secret>","redirectUri":"<your  redirect_uri>","scope":"<your scopes>"}' \
    http://localhost:3000/api/v1/session
  ```

4. (optional) Create a conversation
  > SDK: spark.internal.conversation.create({comment: 'first comment', displayName: 'title', participants: ['<userId1>', '<userId2>', '<userId3>']})

  ```
  curl -X POST \
    -H "Content-Type: application/json" \
    -H "Cookie: <connect.sid cookie from step one>" \
    -d '[{"comment":"first message","displayName":"title","participants":["userId1","userId2","userId3"]}]'
    -v \
    http://localhost:3000/api/v1/session/invoke/internal/conversation/create
  ```

5. (optional) Post a message
  > SDK: `spark.inernal.conversation.post({url: '<conversation url>', {displayName: 'second comment'}})`

  ```
  curl -X POST \
    -H "Content-Type: application/json" \
    -H "Cookie: <connect.sid cookie from step one>" \
    -d [{"url":"<conversation url>"},{"displayName":"second comment"}]
    -v \
    http://localhost:3000/api/v1/session/invoke/internal/conversation/post
  ```

6. (optional) Fetch a conversation
  > SDK: `spark.internal.conversation.get({url: '<conversation url>'})`

  ```
  curl -X POST \
    -H "Content-Type: application/json" \
    -H "Cookie: <connect.sid cookie from step one>" \
    -d [{"url":"<conversation url>"}]
    -v \
    http://localhost:3000/api/v1/session/invoke/internal/conversation/get
  ```

7. Clean up your session (If you don't do this, you'll have a bunch of long-running web socket connections)
  ```
  curl -X DELETE \
    -H "Content-Type: application/json" \
    -H "Cookie: <connect.sid cookie from step one>" \
    -v \
    http://localhost:3000/api/v1/session
  ```
