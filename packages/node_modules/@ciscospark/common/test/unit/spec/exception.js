import {Exception} from '@ciscospark/common';
import {assert} from '@ciscospark/test-helper-chai';
import {skipInBrowser} from '@ciscospark/test-helper-mocha';

describe(`common`, () => {
  describe(`Exception`, () => {
    describe(`#defaultMessage`, () => {
      it(`gets used when no messsage is supplied`, () => {
        const exception = new Exception();
        assert.match(exception.message, /An error occurred/);
        assert.match(exception.toString(), /An error occurred/);
      });

      it(`gets overridden by derived classes`, () => {
        class MyException extends Exception {
          static defaultMessage = `My exception occurred`;
        }
        const exception = new MyException();
        assert.match(exception.message, /My exception occurred/);
        assert.match(exception.toString(), /My exception occurred/);
      });
    });

    // FIXME This works everywhere but IE and I don't have time to debug
    skipInBrowser(it)(`includes the exception class name when stringified`, () => {
      class MyException extends Exception {
        static defaultMessage = `My exception occurred`;
      }

      const m = new MyException();
      assert.match(m.toString(), /MyException:/);
    });
  });
});
