/*!
 * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.
 */

import {assert} from '@ciscospark/test-helper-chai';
import MockSpark from '@ciscospark/test-helper-mock-spark';
import sinon from '@ciscospark/test-helper-sinon';
import Lyra, {config as lyraConfig} from '@ciscospark/internal-plugin-lyra';

describe('plugin-lyra', () => {
  let spark;

  before(() => {
    spark = new MockSpark({
      children: {
        lyra: Lyra
      }
    });

    spark.config.lyra = lyraConfig.lyra;
  });

  beforeEach(() => {
    spark.request.resetHistory();
  });

  describe('lyra', () => {
    describe('#getAdvertisedEndpoint()', () => {
      it('sends GET request to proximity', () => spark.internal.lyra.getAdvertisedEndpoint('token')
        .then(() => assert.calledWith(spark.request, sinon.match({
          method: 'GET',
          api: 'proximity',
          resource: '/ultrasound/advertisements',
          qs: {
            token: 'token'
          }
        }))));
    });
  });
});
